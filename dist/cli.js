"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _terminalKit = require("terminal-kit");

var _detectSong = _interopRequireDefault(require("./detect-song"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var keys = {
  VOLUME_DOWN: 'LEFT',
  VOLUME_UP: 'RIGHT',
  GET_CURRENT_SONG: 'CTRL_A',
  EXIT: 'CTRL_C'
};

var init = function init(lofiStream) {
  _terminalKit.terminal.green.bold('Playing ChilledCow stream...\n');

  _terminalKit.terminal.grabInput();

  var progressBar = _terminalKit.terminal.progressBar({
    width: 80,
    title: 'Volume',
    eta: false,
    percent: true,
    barHeadChar: '=',
    syncMode: true
  });

  var cli = {
    terminal: _terminalKit.terminal,
    progressBar: progressBar
  };
  progressBar.update(lofiStream.volume.volume);

  _terminalKit.terminal.on('key', function (name) {
    return menuOnClick(cli, lofiStream)(name);
  });

  return cli;
};

var menuOnClick = function menuOnClick(cli, lofiStream) {
  return function (keyName) {
    var offset = 0.1;

    switch (keyName) {
      case keys.VOLUME_DOWN:
        if (lofiStream.volume.volume - offset >= 0) lofiStream.volume.setVolume(lofiStream.volume.volume - 0.1);
        break;

      case keys.VOLUME_UP:
        if (lofiStream.volume.volume + offset <= 1) lofiStream.volume.setVolume(lofiStream.volume.volume + 0.1);
        break;

      case keys.GET_CURRENT_SONG:
        (0, _detectSong["default"])();
        break;

      case keys.EXIT:
        process.exit(1);
    }

    cli.progressBar.update(lofiStream.volume.volume);
  };
};

var _default = init;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGkuanMiXSwibmFtZXMiOlsia2V5cyIsIlZPTFVNRV9ET1dOIiwiVk9MVU1FX1VQIiwiR0VUX0NVUlJFTlRfU09ORyIsIkVYSVQiLCJpbml0IiwibG9maVN0cmVhbSIsInRlcm1pbmFsIiwiZ3JlZW4iLCJib2xkIiwiZ3JhYklucHV0IiwicHJvZ3Jlc3NCYXIiLCJ3aWR0aCIsInRpdGxlIiwiZXRhIiwicGVyY2VudCIsImJhckhlYWRDaGFyIiwic3luY01vZGUiLCJjbGkiLCJ1cGRhdGUiLCJ2b2x1bWUiLCJvbiIsIm5hbWUiLCJtZW51T25DbGljayIsImtleU5hbWUiLCJvZmZzZXQiLCJzZXRWb2x1bWUiLCJwcm9jZXNzIiwiZXhpdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsSUFBTUEsSUFBSSxHQUFHO0FBQ1RDLEVBQUFBLFdBQVcsRUFBRSxNQURKO0FBRVRDLEVBQUFBLFNBQVMsRUFBRSxPQUZGO0FBR1RDLEVBQUFBLGdCQUFnQixFQUFFLFFBSFQ7QUFJVEMsRUFBQUEsSUFBSSxFQUFFO0FBSkcsQ0FBYjs7QUFPQSxJQUFNQyxJQUFJLEdBQUcsU0FBUEEsSUFBTyxDQUFBQyxVQUFVLEVBQUk7QUFDdkJDLHdCQUFTQyxLQUFULENBQWVDLElBQWYsQ0FBb0IsZ0NBQXBCOztBQUNBRix3QkFBU0csU0FBVDs7QUFDQSxNQUFNQyxXQUFXLEdBQUdKLHNCQUFTSSxXQUFULENBQXFCO0FBQ3JDQyxJQUFBQSxLQUFLLEVBQUUsRUFEOEI7QUFFckNDLElBQUFBLEtBQUssRUFBRSxRQUY4QjtBQUdyQ0MsSUFBQUEsR0FBRyxFQUFFLEtBSGdDO0FBSXJDQyxJQUFBQSxPQUFPLEVBQUUsSUFKNEI7QUFLckNDLElBQUFBLFdBQVcsRUFBRSxHQUx3QjtBQU1yQ0MsSUFBQUEsUUFBUSxFQUFFO0FBTjJCLEdBQXJCLENBQXBCOztBQVNBLE1BQU1DLEdBQUcsR0FBRztBQUFFWCxJQUFBQSxRQUFRLEVBQUVBLHFCQUFaO0FBQXNCSSxJQUFBQSxXQUFXLEVBQUVBO0FBQW5DLEdBQVo7QUFFQUEsRUFBQUEsV0FBVyxDQUFDUSxNQUFaLENBQW1CYixVQUFVLENBQUNjLE1BQVgsQ0FBa0JBLE1BQXJDOztBQUNBYix3QkFBU2MsRUFBVCxDQUFZLEtBQVosRUFBbUIsVUFBQUMsSUFBSTtBQUFBLFdBQUlDLFdBQVcsQ0FBQ0wsR0FBRCxFQUFNWixVQUFOLENBQVgsQ0FBNkJnQixJQUE3QixDQUFKO0FBQUEsR0FBdkI7O0FBRUEsU0FBT0osR0FBUDtBQUNILENBbEJEOztBQW9CQSxJQUFNSyxXQUFXLEdBQUcsU0FBZEEsV0FBYyxDQUFDTCxHQUFELEVBQU1aLFVBQU47QUFBQSxTQUFxQixVQUFBa0IsT0FBTyxFQUFJO0FBQ2hELFFBQU1DLE1BQU0sR0FBRyxHQUFmOztBQUNBLFlBQVFELE9BQVI7QUFDQSxXQUFLeEIsSUFBSSxDQUFDQyxXQUFWO0FBQ0ksWUFBSUssVUFBVSxDQUFDYyxNQUFYLENBQWtCQSxNQUFsQixHQUEyQkssTUFBM0IsSUFBcUMsQ0FBekMsRUFBNENuQixVQUFVLENBQUNjLE1BQVgsQ0FBa0JNLFNBQWxCLENBQTRCcEIsVUFBVSxDQUFDYyxNQUFYLENBQWtCQSxNQUFsQixHQUEyQixHQUF2RDtBQUM1Qzs7QUFDSixXQUFLcEIsSUFBSSxDQUFDRSxTQUFWO0FBQ0ksWUFBSUksVUFBVSxDQUFDYyxNQUFYLENBQWtCQSxNQUFsQixHQUEyQkssTUFBM0IsSUFBcUMsQ0FBekMsRUFBNENuQixVQUFVLENBQUNjLE1BQVgsQ0FBa0JNLFNBQWxCLENBQTRCcEIsVUFBVSxDQUFDYyxNQUFYLENBQWtCQSxNQUFsQixHQUEyQixHQUF2RDtBQUM1Qzs7QUFDSixXQUFLcEIsSUFBSSxDQUFDRyxnQkFBVjtBQUNJO0FBQ0E7O0FBQ0osV0FBS0gsSUFBSSxDQUFDSSxJQUFWO0FBQ0l1QixRQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiO0FBWEo7O0FBYUFWLElBQUFBLEdBQUcsQ0FBQ1AsV0FBSixDQUFnQlEsTUFBaEIsQ0FBdUJiLFVBQVUsQ0FBQ2MsTUFBWCxDQUFrQkEsTUFBekM7QUFDSCxHQWhCbUI7QUFBQSxDQUFwQjs7ZUFrQmVmLEkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZXJtaW5hbCB9IGZyb20gJ3Rlcm1pbmFsLWtpdCdcbmltcG9ydCBkZXRlY3RTb25nIGZyb20gJy4vZGV0ZWN0LXNvbmcnXG5cbmNvbnN0IGtleXMgPSB7XG4gICAgVk9MVU1FX0RPV046ICdMRUZUJyxcbiAgICBWT0xVTUVfVVA6ICdSSUdIVCcsXG4gICAgR0VUX0NVUlJFTlRfU09ORzogJ0NUUkxfQScsXG4gICAgRVhJVDogJ0NUUkxfQydcbn1cblxuY29uc3QgaW5pdCA9IGxvZmlTdHJlYW0gPT4ge1xuICAgIHRlcm1pbmFsLmdyZWVuLmJvbGQoJ1BsYXlpbmcgQ2hpbGxlZENvdyBzdHJlYW0uLi5cXG4nKVxuICAgIHRlcm1pbmFsLmdyYWJJbnB1dCgpXG4gICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSB0ZXJtaW5hbC5wcm9ncmVzc0Jhcih7XG4gICAgICAgIHdpZHRoOiA4MCxcbiAgICAgICAgdGl0bGU6ICdWb2x1bWUnLFxuICAgICAgICBldGE6IGZhbHNlLFxuICAgICAgICBwZXJjZW50OiB0cnVlLFxuICAgICAgICBiYXJIZWFkQ2hhcjogJz0nLFxuICAgICAgICBzeW5jTW9kZTogdHJ1ZVxuICAgIH0pXG5cbiAgICBjb25zdCBjbGkgPSB7IHRlcm1pbmFsOiB0ZXJtaW5hbCwgcHJvZ3Jlc3NCYXI6IHByb2dyZXNzQmFyIH1cblxuICAgIHByb2dyZXNzQmFyLnVwZGF0ZShsb2ZpU3RyZWFtLnZvbHVtZS52b2x1bWUpXG4gICAgdGVybWluYWwub24oJ2tleScsIG5hbWUgPT4gbWVudU9uQ2xpY2soY2xpLCBsb2ZpU3RyZWFtKShuYW1lKSlcblxuICAgIHJldHVybiBjbGlcbn1cblxuY29uc3QgbWVudU9uQ2xpY2sgPSAoY2xpLCBsb2ZpU3RyZWFtKSA9PiBrZXlOYW1lID0+IHtcbiAgICBjb25zdCBvZmZzZXQgPSAwLjFcbiAgICBzd2l0Y2ggKGtleU5hbWUpIHtcbiAgICBjYXNlIGtleXMuVk9MVU1FX0RPV046XG4gICAgICAgIGlmIChsb2ZpU3RyZWFtLnZvbHVtZS52b2x1bWUgLSBvZmZzZXQgPj0gMCkgbG9maVN0cmVhbS52b2x1bWUuc2V0Vm9sdW1lKGxvZmlTdHJlYW0udm9sdW1lLnZvbHVtZSAtIDAuMSlcbiAgICAgICAgYnJlYWtcbiAgICBjYXNlIGtleXMuVk9MVU1FX1VQOlxuICAgICAgICBpZiAobG9maVN0cmVhbS52b2x1bWUudm9sdW1lICsgb2Zmc2V0IDw9IDEpIGxvZmlTdHJlYW0udm9sdW1lLnNldFZvbHVtZShsb2ZpU3RyZWFtLnZvbHVtZS52b2x1bWUgKyAwLjEpXG4gICAgICAgIGJyZWFrXG4gICAgY2FzZSBrZXlzLkdFVF9DVVJSRU5UX1NPTkc6XG4gICAgICAgIGRldGVjdFNvbmcoKVxuICAgICAgICBicmVha1xuICAgIGNhc2Uga2V5cy5FWElUOlxuICAgICAgICBwcm9jZXNzLmV4aXQoMSlcbiAgICB9XG4gICAgY2xpLnByb2dyZXNzQmFyLnVwZGF0ZShsb2ZpU3RyZWFtLnZvbHVtZS52b2x1bWUpXG59XG5cbmV4cG9ydCBkZWZhdWx0IGluaXRcbiJdfQ==